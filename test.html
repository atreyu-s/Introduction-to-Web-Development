<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Tests for script.js</title>
  <style>
    body { font-family: monospace; margin: 2rem; line-height: 1.6 }
    .test-suite { margin: 1rem 0; border: 1px solid #ccc; padding: 1rem }
    .pass { color: #0a8; font-weight: bold }
    .fail { color: #c33; font-weight: bold }
    .test-output { background: #f5f5f5; padding: 1rem; margin-top: 1rem; border-radius: 4px }
    button { padding: 0.5rem 1rem; font-size: 1rem; margin: 0.25rem }
  </style>
</head>
<body>
  <h1>Testing script.js</h1>
  <p>
    This page runs tests for the toggleMenu function, smooth scrolling, and form validation.
    Open the browser console (F12) to see detailed logs, then click "Run Tests" below.
  </p>

  <div class="test-suite">
    <h2>Test Controls</h2>
    <button onclick="runAllTests()">Run All Tests</button>
    <button onclick="clearOutput()">Clear Output</button>
    <div id="test-output" class="test-output" style="display:none"></div>
  </div>

  <!-- Load the actual site -->
  <iframe id="site-frame" src="index.html" style="width:100%; height:600px; border:2px solid #999; margin-top:1rem" title="Site under test"></iframe>

  <script>
    const output = document.getElementById('test-output');
    const frame = document.getElementById('site-frame');

    function log(msg) {
      console.log(msg);
      if (!output.style.display || output.style.display === 'none') {
        output.style.display = 'block';
      }
      const p = document.createElement('p');
      p.textContent = msg;
      output.appendChild(p);
    }

    function pass(msg) {
      const span = document.createElement('span');
      span.className = 'pass';
      span.textContent = '✓ PASS: ' + msg;
      log(span.textContent);
    }

    function fail(msg) {
      const span = document.createElement('span');
      span.className = 'fail';
      span.textContent = '✗ FAIL: ' + msg;
      log(span.textContent);
    }

    function clearOutput() {
      output.innerHTML = '';
      output.style.display = 'none';
    }

    function runAllTests() {
      clearOutput();
      log('=== Testing script.js ===\n');

      // Wait for iframe to load
      setTimeout(() => {
        try {
          const doc = frame.contentDocument || frame.contentWindow.document;
          const win = frame.contentWindow;

          if (!doc) {
            fail('Could not access iframe document');
            return;
          }

          log('Testing toggleMenu...\n');
          testToggleMenu(doc, win);

          log('\nTesting smooth scroll anchors...\n');
          testSmoothScroll(doc, win);

          log('\nTesting form validation...\n');
          testFormValidation(doc, win);

          log('\n=== All tests completed ===');
        } catch (err) {
          fail('Unexpected error: ' + err.message);
          console.error(err);
        }
      }, 1000);
    }

    function testToggleMenu(doc, win) {
      try {
        const nav = doc.getElementById('nav');
        const btn = doc.getElementById('hamburger');

        if (!nav || !btn) {
          fail('nav or hamburger button not found in DOM');
          return;
        }

        // Initial state: closed
        if (nav.classList.contains('open')) {
          fail('nav should start closed');
          return;
        }
        pass('nav starts closed');

        // Call toggleMenu
        if (typeof win.toggleMenu !== 'function') {
          fail('toggleMenu is not a function on window');
          return;
        }
        win.toggleMenu();

        if (!nav.classList.contains('open')) {
          fail('toggleMenu did not add open class');
          return;
        }
        pass('toggleMenu opens nav');

        if (btn.getAttribute('aria-expanded') !== 'true') {
          fail('aria-expanded not set to true after opening');
          return;
        }
        pass('aria-expanded updated to true');

        // Toggle again
        win.toggleMenu();
        if (nav.classList.contains('open')) {
          fail('toggleMenu did not remove open class');
          return;
        }
        pass('toggleMenu closes nav');

        if (btn.getAttribute('aria-expanded') !== 'false') {
          fail('aria-expanded not set to false after closing');
          return;
        }
        pass('aria-expanded updated to false');
      } catch (err) {
        fail('toggleMenu test threw: ' + err.message);
        console.error(err);
      }
    }

    function testSmoothScroll(doc, win) {
      try {
        const links = doc.querySelectorAll('nav#nav a[href^="#"]');
        if (!links || links.length === 0) {
          fail('no nav anchor links found');
          return;
        }
        pass('found ' + links.length + ' nav anchor links');

        const home = doc.getElementById('home');
        const about = doc.getElementById('about');
        const contact = doc.getElementById('contact');
        if (!home || !about || !contact) {
          fail('section targets (#home, #about, #contact) not found');
          return;
        }
        pass('all section targets (#home, #about, #contact) exist');

        // Check that links point to valid sections
        let allValid = true;
        links.forEach((a) => {
          const href = a.getAttribute('href');
          if (href && href.startsWith('#')) {
            const id = href.slice(1);
            const target = doc.getElementById(id);
            if (!target) {
              fail('anchor link ' + href + ' has no matching element');
              allValid = false;
            }
          }
        });
        if (allValid) pass('all anchor links point to valid sections');
      } catch (err) {
        fail('smooth scroll test threw: ' + err.message);
        console.error(err);
      }
    }

    function testFormValidation(doc, win) {
      try {
        const form = doc.getElementById('contact-form');
        const nameInput = doc.getElementById('contact-name');
        const emailInput = doc.getElementById('contact-email');
        const messageInput = doc.getElementById('contact-message');
        const feedback = doc.getElementById('contact-feedback');

        if (!form || !nameInput || !emailInput || !messageInput || !feedback) {
          fail('form, inputs, or feedback element not found');
          return;
        }
        pass('form and all input fields found');

        // Test 1: empty submit should show errors
        form.reset();
        const submitBtn = form.querySelector('button[type="submit"]');
        if (submitBtn) {
          submitBtn.click();
          // Give handlers time to run
          setTimeout(() => {
            const nameErr = doc.getElementById('contact-name-error');
            const emailErr = doc.getElementById('contact-email-error');
            const msgErr = doc.getElementById('contact-message-error');

            if (nameErr && nameErr.textContent) {
              pass('empty name shows error: "' + nameErr.textContent + '"');
            } else {
              fail('empty name did not show error message');
            }

            if (emailErr && emailErr.textContent) {
              pass('empty email shows error: "' + emailErr.textContent + '"');
            } else {
              fail('empty email did not show error message');
            }

            if (msgErr && msgErr.textContent) {
              pass('empty message shows error: "' + msgErr.textContent + '"');
            } else {
              fail('empty message did not show error message');
            }

            // Test 2: invalid email shows error
            emailInput.value = 'not-an-email';
            emailInput.dispatchEvent(new win.Event('input', { bubbles: true }));
            setTimeout(() => {
              const emailErr = doc.getElementById('contact-email-error');
              if (emailErr && emailErr.textContent) {
                pass('invalid email shows error: "' + emailErr.textContent + '"');
              } else {
                fail('invalid email did not show error');
              }

              // Test 3: valid submit shows success
              form.reset();
              nameInput.value = 'Test User';
              emailInput.value = 'test@example.com';
              messageInput.value = 'Test message';

              // Dispatch input events to clear any inline errors
              nameInput.dispatchEvent(new win.Event('input', { bubbles: true }));
              emailInput.dispatchEvent(new win.Event('input', { bubbles: true }));
              messageInput.dispatchEvent(new win.Event('input', { bubbles: true }));

              // Submit
              const evt = new win.Event('submit', { bubbles: true, cancelable: true });
              form.dispatchEvent(evt);

              setTimeout(() => {
                if (feedback.textContent && /sent|success/i.test(feedback.textContent)) {
                  pass('valid submit shows success: "' + feedback.textContent + '"');
                } else {
                  fail('valid submit did not show success message');
                }

                if (nameInput.value === '' && emailInput.value === '' && messageInput.value === '') {
                  pass('form fields cleared after successful submit');
                } else {
                  fail('form fields were not cleared after submit');
                }
              }, 50);
            }, 50);
          }, 50);
        }
      } catch (err) {
        fail('form validation test threw: ' + err.message);
        console.error(err);
      }
    }
  </script>
</body>
</html>
